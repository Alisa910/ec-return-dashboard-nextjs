@echo off
chcp 65001 >nul
color 0A
title ECé€€è´§ç‡Dashboard - ç«‹å³å¯åŠ¨

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                           â•‘
echo â•‘        ECé€€è´§ç‡Dashboard - ä¸€é”®å¯åŠ¨éƒ¨ç½²ç³»ç»Ÿ               â•‘
echo â•‘                                                           â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: è·å–å½“å‰ç›®å½•
set "PROJECT_DIR=%~dp0"
cd /d "%PROJECT_DIR%"

echo [æ­¥éª¤ 1/4] ç¯å¢ƒæ£€æŸ¥...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: æ£€æŸ¥Node.js
where node >nul 2>nul
if %errorlevel% neq 0 (
    color 0C
    echo âŒ æœªæ£€æµ‹åˆ° Node.js
    echo.
    echo è¯·å…ˆå®‰è£… Node.js: https://nodejs.org/
    echo.
    pause
    exit /b
)

echo âœ… Node.js: 
node --version
echo.

:: æ£€æŸ¥npm
where npm >nul 2>nul
if %errorlevel% neq 0 (
    color 0C
    echo âŒ npm æœªæ‰¾åˆ°
    pause
    exit /b
)

echo âœ… npm: 
npm --version
echo.

echo [æ­¥éª¤ 2/4] æ£€æŸ¥ä¾èµ–...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

if not exist "node_modules" (
    echo âš ï¸  é¦–æ¬¡è¿è¡Œï¼Œéœ€è¦å®‰è£…ä¾èµ–...
    echo ğŸ“¦ æ­£åœ¨å®‰è£…ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼ˆçº¦2-3åˆ†é’Ÿï¼‰...
    echo.
    
    call npm install --loglevel=error
    
    if %errorlevel% neq 0 (
        color 0C
        echo.
        echo âŒ ä¾èµ–å®‰è£…å¤±è´¥
        echo.
        echo ğŸ’¡ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š
        echo    1. æ£€æŸ¥ç½‘ç»œè¿æ¥
        echo    2. åˆ é™¤ node_modules æ–‡ä»¶å¤¹é‡è¯•
        echo    3. ä½¿ç”¨æ·˜å®é•œåƒ: npm config set registry https://registry.npmmirror.com
        echo.
        pause
        exit /b
    )
    
    echo.
    echo âœ… ä¾èµ–å®‰è£…å®Œæˆ
    echo.
) else (
    echo âœ… ä¾èµ–å·²å®‰è£…
    echo.
)

echo [æ­¥éª¤ 3/4] æ£€æŸ¥æ•°æ®æ–‡ä»¶...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

if exist "public\data\processed_data.json" (
    echo âœ… æ•°æ®æ–‡ä»¶å·²å°±ç»ª
    echo    ä½ç½®: public\data\processed_data.json
    echo.
) else (
    color 0E
    echo âš ï¸  æ•°æ®æ–‡ä»¶æœªæ‰¾åˆ°
    echo.
    echo ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹æ•°æ®æˆ–å¤„ç†çœŸå®æ•°æ®ï¼š
    echo.
    echo    é€‰é¡¹1: é¡¹ç›®å·²åŒ…å«ç¤ºä¾‹æ•°æ®ï¼Œå¯ç›´æ¥æŸ¥çœ‹æ•ˆæœ
    echo    é€‰é¡¹2: å¦‚éœ€çœŸå®æ•°æ®ï¼Œè¯·å…ˆè¿è¡Œ "ğŸ“Šå¤„ç†æ•°æ®.bat"
    echo.
    
    choice /C YN /M "æ˜¯å¦ç»§ç»­å¯åŠ¨ï¼ˆä½¿ç”¨ç¤ºä¾‹æ•°æ®ï¼‰"
    if %errorlevel%==2 (
        echo.
        echo å·²å–æ¶ˆå¯åŠ¨
        pause
        exit /b
    )
    echo.
)

echo [æ­¥éª¤ 4/4] å¯åŠ¨å¼€å‘æœåŠ¡å™¨...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

echo ğŸš€ æ­£åœ¨å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨...
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                           â•‘
echo â•‘   Dashboard åœ°å€: http://localhost:3000                  â•‘
echo â•‘                                                           â•‘
echo â•‘   ğŸ“Š é¦–é¡µ - æ¸ é“æ¦‚è§ˆ                                      â•‘
echo â•‘   ğŸ” è¯¦æƒ…é¡µ - åº—é“ºåˆ†æ                                    â•‘
echo â•‘   âš ï¸  é£é™©è¯†åˆ« - æ™ºèƒ½æé†’                                 â•‘
echo â•‘                                                           â•‘
echo â•‘   ğŸ’¡ æç¤º:                                                â•‘
echo â•‘   â€¢ æµè§ˆå™¨å°†åœ¨3ç§’åè‡ªåŠ¨æ‰“å¼€                              â•‘
echo â•‘   â€¢ ä¿®æ”¹ä»£ç åé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°                             â•‘
echo â•‘   â€¢ æŒ‰ Ctrl+C å¯åœæ­¢æœåŠ¡å™¨                               â•‘
echo â•‘                                                           â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: å»¶è¿Ÿ3ç§’åæ‰“å¼€æµè§ˆå™¨
start "" cmd /c "timeout /t 3 >nul && start http://localhost:3000"

:: å¯åŠ¨Next.js
echo æœåŠ¡å™¨å¯åŠ¨ä¸­...
echo.
npm run dev

:: å¦‚æœæœåŠ¡å™¨åœæ­¢
echo.
echo æœåŠ¡å™¨å·²åœæ­¢
pause