# ⚠️ Dashboard 数据显示问题诊断

如果 Dashboard 显示的数据不是你的真实数据，请按以下步骤排查：

---

## 🔍 问题诊断步骤

### 1️⃣ 确认数据文件存在

**检查文件：**
```
public/data/EC退货率变化.csv
```

**验证方法：**
- 打开文件资源管理器
- 进入项目目录：`d:\cursor-HQ文件夹\ec-return-dashboard-nextjs\public\data\`
- 确认文件 `EC退货率变化.csv` 存在
- 文件大小应该约 2KB（不是 0 字节）

**如果文件不存在或为空：**
```bash
cd /d "d:\cursor-HQ文件夹\ec-return-dashboard-nextjs"
npm run convert-data
```

---

### 2️⃣ 检查数据内容

**打开文件验证：**
```
public/data/EC退货率变化.csv
```

**应该看到：**
```csv
Year,Channel,Shop_Name,Return_Rate_YTD,Net_Sales
2024,天猫旗舰店,MM 天猫旗舰店,46,434633487.91
2025,天猫旗舰店,MM 天猫旗舰店,49,463188665.53
...
```

**数据行数：** 34 行（含表头）

**如果数据不对：**
1. 检查原始数据：`public/data/EC退货率变化_原始.csv`
2. 重新运行转换：`npm run convert-data`

---

### 3️⃣ 清理缓存

**问题原因：**
- Next.js 构建缓存
- 浏览器缓存
- Node.js 模块缓存

**解决方法A：使用清理脚本（推荐）⭐**

**双击运行：**
```
📄 d:\cursor-HQ文件夹\🔄清理缓存并启动(根目录).bat
```

或者：
```
📄 d:\cursor-HQ文件夹\ec-return-dashboard-nextjs\🔄清理缓存并启动.bat
```

**解决方法B：手动清理**

1. **关闭当前运行的开发服务器**（按 Ctrl + C）

2. **删除缓存文件夹：**
   ```cmd
   cd /d "d:\cursor-HQ文件夹\ec-return-dashboard-nextjs"
   rmdir /s /q .next
   rmdir /s /q node_modules\.cache
   ```

3. **重新启动：**
   ```cmd
   npm run dev
   ```

---

### 4️⃣ 强制刷新浏览器

**重要！** 即使服务器重启，浏览器可能还缓存了旧数据。

**方法1：硬刷新（强制刷新）**
```
按 Ctrl + Shift + R
或
按 Ctrl + F5
```

**方法2：清除浏览器缓存**
1. 按 `F12` 打开开发者工具
2. 右键点击刷新按钮
3. 选择"清空缓存并硬性重新加载"

**方法3：无痕模式**
```
按 Ctrl + Shift + N (Chrome)
或
按 Ctrl + Shift + P (Firefox)
```

---

### 5️⃣ 验证配置文件

**检查：**
```typescript
// lib/config.ts
export const DATA_FILE_PATH = '/data/EC退货率变化.csv'  // ✅ 正确
```

**❌ 错误示例：**
```typescript
export const DATA_FILE_PATH = '/data/sample_data.csv'  // ❌ 错误！
```

**如果配置错误：**
1. 打开文件：`lib/config.ts`
2. 修改第 28 行为：`export const DATA_FILE_PATH = '/data/EC退货率变化.csv'`
3. 保存文件
4. 重启服务器

---

### 6️⃣ 检查控制台错误

**打开浏览器开发者工具：**
```
按 F12
```

**切换到 Console 标签页**

**查找错误信息：**
- ❌ `404 Not Found: /data/EC退货率变化.csv`
  → 数据文件不存在，运行 `npm run convert-data`

- ❌ `Failed to fetch`
  → 网络问题或文件路径错误

- ⚠️ `数据质量问题`
  → 数据格式有问题，检查原始数据

- ✅ 没有错误
  → 可能是缓存问题，强制刷新浏览器

---

## 🎯 完整解决方案（推荐）

**按顺序执行以下步骤：**

### Step 1: 关闭当前服务器
在运行 `npm run dev` 的命令窗口按 `Ctrl + C`

### Step 2: 清理并重启
**双击运行：**
```
📄 d:\cursor-HQ文件夹\🔄清理缓存并启动(根目录).bat
```

### Step 3: 等待启动成功
看到以下信息：
```
✓ Ready in 3.2s
○ Local:        http://localhost:3000
```

### Step 4: 强制刷新浏览器
在浏览器按 `Ctrl + Shift + R`

### Step 5: 验证数据
检查首页是否显示：
- ✅ 天猫旗舰店（6家店铺）
- ✅ 京东自营（4家店铺）
- ✅ 抖音电商（4家店铺）
- ✅ 微信商城（1家店铺）
- ✅ 唯品会（4家店铺）

---

## 🔍 数据验证清单

**首页应该显示：**

| 渠道 | 店铺数 | 示例店铺 |
|------|--------|----------|
| 天猫旗舰店 | 6 家 | MM 天猫旗舰店 |
| 京东自营 | 4 家 | MM 京东旗舰店 |
| 抖音电商 | 4 家 | ML 抖音鞋服旗舰店 |
| 微信商城 | 1 家 | ML 微商城 |
| 唯品会 | 4 家 | VIPMLB |

**品牌统计应该显示：**
- ⚾ MLB：8 家店铺
- 👶 MLB KIDS：6 家店铺
- 🔍 Discovery：5 家店铺

**新开店铺（5家）：**
- DX 京东旗舰店
- MK 抖音儿童旗舰店
- DX 抖音旗舰店
- VIPSP
- VIPDV

---

## 🆘 仍然有问题？

### 检查终端输出
查看启动时的日志，是否有错误信息。

### 检查数据文件权限
确保文件不是只读，可以被正常访问。

### 完全重新转换数据

```bash
cd /d "d:\cursor-HQ文件夹\ec-return-dashboard-nextjs"

# 删除旧数据
del public\data\EC退货率变化.csv

# 重新转换
npm run convert-data

# 验证文件
dir public\data\EC退货率变化.csv

# 重启服务
npm run dev
```

---

## 📝 常见问题

### Q: 数据文件存在，但还是显示示例数据？
A: 清理缓存并强制刷新浏览器（Ctrl + Shift + R）

### Q: 店铺数量不对？
A: 检查品牌映射规则（lib/config.ts），确保所有店铺都被正确分类

### Q: 某些店铺没有显示？
A: 检查店铺名称是否匹配品牌映射规则中的关键词

### Q: 数据显示为 0 或 NaN？
A: 检查原始数据文件格式，运行 `npm run convert-data` 重新转换

---

## ✅ 最终验证

**在浏览器控制台（F12）运行：**

```javascript
// 检查数据文件路径
console.log('Data file path:', '/data/EC退货率变化.csv')

// 手动获取数据
fetch('/data/EC退货率变化.csv')
  .then(r => r.text())
  .then(data => {
    const lines = data.split('\n')
    console.log('总行数:', lines.length)
    console.log('前5行:', lines.slice(0, 5).join('\n'))
  })
```

**应该输出：**
```
总行数: 34
前5行:
Year,Channel,Shop_Name,Return_Rate_YTD,Net_Sales
2024,天猫旗舰店,MM 天猫旗舰店,46,434633487.91
2025,天猫旗舰店,MM 天猫旗舰店,49,463188665.53
...
```

---

## 🎊 成功标志

当你看到以下内容，说明数据配置成功：

✅ 首页显示 5 个渠道卡片（不是 3 个）  
✅ 总共 19 家店铺  
✅ 店铺名称是真实的（MM 天猫旗舰店、ML 抖音鞋服旗舰店等）  
✅ 点击卡片进入详情页能看到完整店铺列表  
✅ 有 5 家店铺标记为"🆕 新开店"  

---

**现在就试试：双击运行 🔄清理缓存并启动.bat** 🚀
